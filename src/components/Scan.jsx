import { useState } from "react";
import { saveRecords, uploadAndScanFiles } from "./utils/axiosInstance";

const Scan = () => {
    const [file, setFile] = useState(null);

    const [isFileSelected, setIsFileSelected] = useState(false);
    const [isUploaded, setIsUploaded] = useState(false);
    const [data, setData] = useState([]);

    const selectFile = async (event) => {
        setIsFileSelected(true);
        setFile(event.target);
    }

    const uploadFile = async () => {
        const data = await uploadAndScanFiles(file.files[0], file.value);
        console.log(data);
        setData(data);
        setIsUploaded(true);
    }

    const saveRecordsToDb = ()=>{
        const reqBody = data;
        reqBody.id = localStorage.getItem("user-id");
        saveRecords(reqBody);
    }

    return <>
        <div className="d-flex align-items-center justify-content-center mt-5">
            <input type="file" onChange={selectFile} />
            <button className="btn btn-primary" onClick={uploadFile} disabled={!isFileSelected}>Upload</button>
        </div>

        {isUploaded ? <> <table class="table table-striped table-dark table-hover">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Error Line</th>
                    <th scope="col">Error Description</th>
                </tr>
            </thead>
            <tbody>
                {data.errors.map((row, i) => {
                    return <tr key={i}>
                        <th scope="row">{i + 1}</th>
                        <td>{"Line number - " + row['Error line']}</td>
                        <td>{row['Error Description']}</td>
                    </tr>
                })}
            </tbody>
        </table>
            <div className="d-flex justify-content-center">
                <button className="btn btn-success mr-2" onClick={saveRecordsToDb}>Save Records</button>
                <button className="btn btn-warning">Ignore</button>
            </div>
        </>
            : <></>}
    </>
}

export default Scan;